#include "melody.h"
#include <stdint.h>
extern void play_note(float freq,uint16_t duration);

// Melody array
//const melody_s mary_lamb_melody[MARY_LAMB_LENGTH] = {
//    {329.63, 1.0}, {293.66, 1.0}, {261.63, 1.0}, {293.66, 1.0}, {329.63, 1.0}, {329.63, 1.0}, {329.63, 1.2},
//    {293.66, 1.0}, {293.66, 1.0}, {293.66, 1.2}, {329.63, 1.0}, {392.00, 1.0}, {392.00, 1.2},
//    {329.63, 1.0}, {293.66, 1.0}, {261.63, 1.0}, {293.66, 1.0}, {329.63, 1.0}, {329.63, 1.0}, {329.63, 1.0},
//    {293.66, 1.0}, {293.66, 1.0}, {329.63, 1.0}, {293.66, 1.0}, {261.63, 1.2}
//};

const double C4 = 261.63;
const double D4 = 293.66;
const double E4 = 329.63;
const double G4 = 392.00;

// Define note durations based on a tempo of 120 BPM.
// At 120 BPM, a quarter note is 0.5 seconds.
const double QUARTER_NOTE = 0.5;
const double HALF_NOTE = 1.0;

// An array of Note structs representing the melody.
// This is the sequence of notes for "Mary Had a Little Lamb."
const melody_s mary_lamb_melody[] = {
    // "Mary had a lit-tle lamb"
    {E4, QUARTER_NOTE}, {D4, QUARTER_NOTE}, {C4, QUARTER_NOTE}, {D4, QUARTER_NOTE},
    {E4, QUARTER_NOTE}, {E4, QUARTER_NOTE}, {E4, HALF_NOTE},

    // "lit-tle lamb, lit-tle lamb"
    {D4, QUARTER_NOTE}, {D4, QUARTER_NOTE}, {D4, HALF_NOTE},
    {E4, QUARTER_NOTE}, {G4, QUARTER_NOTE}, {G4, HALF_NOTE},

    // "Ma-ry had a lit-tle lamb"
    {E4, QUARTER_NOTE}, {D4, QUARTER_NOTE}, {C4, QUARTER_NOTE}, {D4, QUARTER_NOTE},
    {E4, QUARTER_NOTE}, {E4, QUARTER_NOTE}, {E4, HALF_NOTE},

    // "its fleece was white as snow"
    {E4, QUARTER_NOTE}, {D4, QUARTER_NOTE}, {D4, QUARTER_NOTE}, {E4, QUARTER_NOTE},
    {D4, QUARTER_NOTE}, {C4, HALF_NOTE}
};

void play_melody(const melody_s* mel,int len)
{
	for(int i=0;i<len;i++)
	{
		play_note(mel[i].note_freq , mel[i].seconds * 1000 );
	}
}
